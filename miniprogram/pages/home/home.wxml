<!--pages/home/home.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar"></view>

  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header-section">
    <view class="header-content">
      <view class="welcome-info">
        <view class="welcome-text">ğŸŒ± è–„è·ç”Ÿæ´»</view>
        <view class="welcome-subtitle">è®©ç”Ÿæ´»æ›´ç²¾è‡´</view>
      </view>
      <view class="header-avatar">
        <image src="/images/default-avatar.png" class="avatar-img" mode="aspectFill" />
      </view>
    </view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content">
    <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
    <view class="overview-section">
      <view class="overview-header">
        <view class="section-title">ğŸ“Š æœ¬æœˆæ¦‚è§ˆ</view>
        <view class="section-subtitle">{{currentMonth}}æœˆè´¢åŠ¡çŠ¶å†µ</view>
      </view>

      <view class="summary-cards">
        <view class="summary-card income-card hover-float tap-feedback">
          <view class="card-header">
            <view class="card-icon income-icon">ğŸ’</view>
            <view class="card-label">æ”¶å…¥</view>
          </view>
          <view class="card-amount">Â¥{{monthlyIncome}}</view>
          <view class="card-trend income">â†— {{incomeGrowth}}%</view>
        </view>

        <view class="summary-card expense-card hover-float tap-feedback">
          <view class="card-header">
            <view class="card-icon expense-icon">ğŸ›’</view>
            <view class="card-label">æ”¯å‡º</view>
          </view>
          <view class="card-amount">Â¥{{monthlyExpense}}</view>
          <view class="card-trend expense">â†— {{expenseGrowth}}%</view>
        </view>

        <view class="summary-card balance-card hover-float tap-feedback">
          <view class="card-header">
            <view class="card-icon balance-icon">ğŸ’°</view>
            <view class="card-label">ç»“ä½™</view>
          </view>
          <view class="card-amount">Â¥{{monthlyBalance}}</view>
          <view class="card-trend {{balanceGrowth >= 0 ? 'income' : 'expense'}}">
            {{balanceGrowth >= 0 ? 'â†—' : 'â†˜'}} {{Math.abs(balanceGrowth)}}%
          </view>
        </view>
      </view>
    </view>

    <!-- å¥åº·å‘¨æœŸå¡ç‰‡ -->
    <view class="health-section">
      <view class="period-card">
        <view class="period-header">
          <view class="period-icon">ğŸŒ¸</view>
          <view class="period-title">å¥åº·å‘¨æœŸ</view>
          <view class="period-status">{{periodStatus}}</view>
        </view>
        <view class="period-content">
          <view class="period-main-info">
            <view class="days-count">{{daysToNextPeriod}}</view>
            <view class="days-label">å¤©å</view>
          </view>
          <view class="period-details">
            <view class="detail-item">
              <text class="detail-label">å‘¨æœŸ</text>
              <text class="detail-value">{{averageCycle}}å¤©</text>
            </view>
            <view class="detail-item">
              <text class="detail-label">å‡†ç¡®ç‡</text>
              <text class="detail-value">{{accuracy}}%</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="actions-section">
      <view class="section-header">
        <view class="section-title">âš¡ å¿«æ·æ“ä½œ</view>
      </view>
      <view class="action-grid">
        <button class="action-item income-action tap-feedback" bindtap="openTransactionModal" data-type="income">
          <view class="action-icon">ğŸ’</view>
          <view class="action-label">è®°å½•æ”¶å…¥</view>
        </button>
        <button class="action-item expense-action tap-feedback" bindtap="openTransactionModal" data-type="expense">
          <view class="action-icon">ğŸ›’</view>
          <view class="action-label">è®°å½•æ”¯å‡º</view>
        </button>
        <button class="action-item period-action tap-feedback" bindtap="navigateToPeriod">
          <view class="action-icon">ğŸŒ¸</view>
          <view class="action-label">ç»æœŸè®°å½•</view>
        </button>
        <button class="action-item stats-action tap-feedback" bindtap="navigateToAccounting">
          <view class="action-icon">ğŸ“Š</view>
          <view class="action-label">æŸ¥çœ‹ç»Ÿè®¡</view>
        </button>
      </view>
    </view>

    <!-- æœ€è¿‘äº¤æ˜“ -->
    <view class="transactions-section" wx:if="{{recentTransactions.length > 0}}">
      <view class="section-header">
        <view class="section-title">ğŸ“ æœ€è¿‘äº¤æ˜“</view>
        <view class="section-action" bindtap="navigateToAccounting">æŸ¥çœ‹å…¨éƒ¨</view>
      </view>
      <view class="transaction-list">
        <view class="transaction-item hover-float" wx:for="{{recentTransactions}}" wx:key="id">
          <view class="transaction-icon {{item.category}}">{{item.icon}}</view>
          <view class="transaction-info">
            <view class="transaction-title">{{item.title}}</view>
            <view class="transaction-meta">{{item.time}} Â· {{item.categoryName}}</view>
          </view>
          <view class="transaction-amount {{item.type === 'income' ? 'amount-income' : 'amount-expense'}}">
            {{item.type === 'income' ? '+' : '-'}}Â¥{{item.amount}}
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- æ·»åŠ äº¤æ˜“å¼¹çª— -->
<view class="modal" wx:if="{{showModal}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">{{modalType === 'income' ? 'âœ¨ æ·»åŠ æ”¶å…¥' : 'ğŸ›’ æ·»åŠ æ”¯å‡º'}}</view>
      <button class="close-btn" bindtap="closeModal">âœ•</button>
    </view>
    
    <form bindsubmit="submitTransaction">
      <view class="form-group">
        <view class="form-label">ğŸ’° é‡‘é¢</view>
        <input class="form-input" type="digit" placeholder="è¯·è¾“å…¥é‡‘é¢" name="amount" value="{{formData.amount}}" bindinput="onAmountInput" />
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ·ï¸ åˆ†ç±»</view>
        <view class="category-grid grid grid-4">
          <view class="category-item {{selectedCategory === item.value ? 'selected' : ''}}" 
                wx:for="{{categories}}" wx:key="value"
                bindtap="selectCategory" data-value="{{item.value}}">
            {{item.label}}
          </view>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ“ å¤‡æ³¨</view>
        <input class="form-input" placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰" name="note" value="{{formData.note}}" bindinput="onNoteInput" />
      </view>
      
      <button class="submit-btn btn-primary" form-type="submit">ç¡®è®¤æ·»åŠ </button>
    </form>
  </view>
</view>
