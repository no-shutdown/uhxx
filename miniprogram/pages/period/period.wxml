<!--pages/period/period.wxml-->
<view class="container">
  <!-- æ—¥å†å®¹å™¨ -->
  <view class="calendar-container card">
    <view class="calendar-header">
      <button class="calendar-nav" bindtap="prevMonth">â€¹</button>
      <view class="calendar-title">{{currentYear}}å¹´{{currentMonth}}æœˆ</view>
      <button class="calendar-nav" bindtap="nextMonth">â€º</button>
    </view>
    
    <view class="calendar-grid">
      <!-- æ˜ŸæœŸæ ‡é¢˜ -->
      <view class="calendar-weekday" wx:for="{{weekdays}}" wx:key="*this">{{item}}</view>
      
      <!-- æ—¥æœŸ -->
      <view class="calendar-day {{item.class}}" 
            wx:for="{{calendarDays}}" wx:key="date"
            bindtap="selectDate" data-date="{{item.date}}">
        {{item.day}}
      </view>
    </view>
    
    <!-- å›¾ä¾‹è¯´æ˜ -->
    <view class="calendar-legend">
      <view class="legend-item">
        <view class="legend-dot period"></view>
        <text>ç»æœŸ</text>
      </view>
      <view class="legend-item">
        <view class="legend-dot ovulation"></view>
        <text>æ’åµæœŸ</text>
      </view>
      <view class="legend-item">
        <view class="legend-dot predicted"></view>
        <text>é¢„æµ‹</text>
      </view>
      <view class="legend-item">
        <view class="legend-dot today"></view>
        <text>ä»Šå¤©</text>
      </view>
    </view>
  </view>

  <!-- å¥åº·ç»Ÿè®¡ -->
  <view class="period-stats card">
    <view class="stats-header">
      <view class="stats-title">ğŸ“Š å¥åº·ç»Ÿè®¡</view>
      <view class="stats-subtitle">åŸºäºæ™ºèƒ½ç®—æ³•çš„ä¸ªæ€§åŒ–åˆ†æ</view>
    </view>
    
    <view class="stats-grid grid grid-2">
      <view class="stat-item">
        <view class="stat-number">{{averageCycle}}</view>
        <view class="stat-label">å¹³å‡å‘¨æœŸï¼ˆå¤©ï¼‰</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{averagePeriod}}</view>
        <view class="stat-label">å¹³å‡ç»æœŸï¼ˆå¤©ï¼‰</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{daysToNext}}</view>
        <view class="stat-label">è·ä¸‹æ¬¡ç»æœŸ</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{accuracy}}%</view>
        <view class="stat-label">é¢„æµ‹å‡†ç¡®ç‡</view>
      </view>
    </view>
  </view>

  <!-- å‘¨æœŸä¿¡æ¯ -->
  <view class="cycle-info card">
    <view class="info-title">ğŸŒ¸ å‘¨æœŸä¿¡æ¯</view>
    <view class="info-content">
      <view class="info-item">
        <view class="info-label">ä¸Šæ¬¡ç»æœŸ</view>
        <view class="info-value">{{lastPeriodText}}</view>
      </view>
      <view class="info-item">
        <view class="info-label">ä¸‹æ¬¡é¢„æµ‹</view>
        <view class="info-value">{{nextPeriodText}}</view>
      </view>
      <view class="info-item">
        <view class="info-label">æ’åµæœŸ</view>
        <view class="info-value">{{ovulationText}}</view>
      </view>
    </view>
  </view>

  <!-- è®°å½•æŒ‰é’® -->
  <view class="record-buttons">
    <button class="record-btn period-btn" bindtap="recordPeriod">
      <text class="btn-icon">ğŸŒ¸</text>
      <text>è®°å½•ç»æœŸ</text>
    </button>
    <button class="record-btn symptom-btn" bindtap="recordSymptom">
      <text class="btn-icon">ğŸ“</text>
      <text>è®°å½•ç—‡çŠ¶</text>
    </button>
  </view>
</view>

<!-- è®°å½•ç»æœŸå¼¹çª— -->
<view class="modal" wx:if="{{showPeriodModal}}" bindtap="closePeriodModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">ğŸŒ¸ è®°å½•ç»æœŸ</view>
      <button class="close-btn" bindtap="closePeriodModal">Ã—</button>
    </view>
    
    <form bindsubmit="submitPeriodRecord">
      <view class="form-group">
        <view class="form-label">ğŸ“… å¼€å§‹æ—¥æœŸ</view>
        <picker mode="date" value="{{periodForm.startDate}}" bindchange="onStartDateChange">
          <view class="form-input picker-input">{{periodForm.startDate || 'è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ'}}</view>
        </picker>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ“… ç»“æŸæ—¥æœŸ</view>
        <picker mode="date" value="{{periodForm.endDate}}" bindchange="onEndDateChange">
          <view class="form-input picker-input">{{periodForm.endDate || 'è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ'}}</view>
        </picker>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ’§ æµé‡</view>
        <view class="flow-options">
          <view class="flow-option {{periodForm.flow === item.value ? 'selected' : ''}}"
                wx:for="{{flowOptions}}" wx:key="value"
                bindtap="selectFlow" data-value="{{item.value}}">
            <text class="flow-icon">{{item.icon}}</text>
            <text class="flow-text">{{item.label}}</text>
          </view>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ“ å¤‡æ³¨</view>
        <textarea class="form-textarea" placeholder="è®°å½•ç—‡çŠ¶ã€å¿ƒæƒ…ç­‰ï¼ˆå¯é€‰ï¼‰" 
                  value="{{periodForm.note}}" bindinput="onPeriodNoteInput"></textarea>
      </view>
      
      <button class="submit-btn btn-primary" form-type="submit">ç¡®è®¤è®°å½•</button>
    </form>
  </view>
</view>

<!-- è®°å½•ç—‡çŠ¶å¼¹çª— -->
<view class="modal" wx:if="{{showSymptomModal}}" bindtap="closeSymptomModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">ğŸ“ è®°å½•ç—‡çŠ¶</view>
      <button class="close-btn" bindtap="closeSymptomModal">Ã—</button>
    </view>
    
    <form bindsubmit="submitSymptomRecord">
      <view class="form-group">
        <view class="form-label">ğŸ“… æ—¥æœŸ</view>
        <picker mode="date" value="{{symptomForm.date}}" bindchange="onSymptomDateChange">
          <view class="form-input picker-input">{{symptomForm.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ˜Š å¿ƒæƒ…</view>
        <view class="mood-options">
          <view class="mood-option {{symptomForm.mood === item.value ? 'selected' : ''}}"
                wx:for="{{moodOptions}}" wx:key="value"
                bindtap="selectMood" data-value="{{item.value}}">
            {{item.icon}}
          </view>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ©º ç—‡çŠ¶</view>
        <view class="symptom-grid">
          <view class="symptom-item {{symptomForm.symptoms.includes(item.value) ? 'selected' : ''}}"
                wx:for="{{symptomOptions}}" wx:key="value"
                bindtap="toggleSymptom" data-value="{{item.value}}">
            <text class="symptom-icon">{{item.icon}}</text>
            <text class="symptom-text">{{item.label}}</text>
          </view>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ“ å¤‡æ³¨</view>
        <textarea class="form-textarea" placeholder="å…¶ä»–ç—‡çŠ¶æˆ–å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" 
                  value="{{symptomForm.note}}" bindinput="onSymptomNoteInput"></textarea>
      </view>
      
      <button class="submit-btn btn-primary" form-type="submit">ç¡®è®¤è®°å½•</button>
    </form>
  </view>
</view>
