<!--pages/accounting/accounting.wxml-->
<view class="container">
  <!-- æ—¶é—´ç­›é€‰ -->
  <view class="filter-tabs">
    <button class="filter-tab {{activeFilter === 'today' ? 'active' : ''}}" 
            bindtap="switchFilter" data-filter="today">ä»Šæ—¥</button>
    <button class="filter-tab {{activeFilter === 'month' ? 'active' : ''}}" 
            bindtap="switchFilter" data-filter="month">æœ¬æœˆ</button>
    <button class="filter-tab {{activeFilter === 'year' ? 'active' : ''}}" 
            bindtap="switchFilter" data-filter="year">æœ¬å¹´</button>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="summary-overview card">
    <view class="overview-item">
      <view class="overview-label">æ€»æ”¶å…¥</view>
      <view class="overview-amount income">Â¥{{totalIncome}}</view>
    </view>
    <view class="overview-divider"></view>
    <view class="overview-item">
      <view class="overview-label">æ€»æ”¯å‡º</view>
      <view class="overview-amount expense">Â¥{{totalExpense}}</view>
    </view>
    <view class="overview-divider"></view>
    <view class="overview-item">
      <view class="overview-label">å‡€æ”¶å…¥</view>
      <view class="overview-amount {{netIncome >= 0 ? 'income' : 'expense'}}">Â¥{{netIncome}}</view>
    </view>
  </view>

  <!-- å›¾è¡¨å±•ç¤º -->
  <view class="chart-container card">
    <view class="chart-header">
      <view class="chart-title">ğŸ“Š æ”¯å‡ºåˆ†æ</view>
      <view class="chart-subtitle">{{filterText}}æ”¯å‡º Â¥{{totalExpense}} Â· {{topCategory}}å æ¯”æœ€é«˜</view>
    </view>
    <view class="chart-placeholder">
      <view class="chart-circle">
        <view class="chart-center">
          <view class="chart-amount">Â¥{{totalExpense}}</view>
          <view class="chart-label">æ€»æ”¯å‡º</view>
        </view>
      </view>
    </view>
    <view class="chart-legend">
      <view class="legend-item" wx:for="{{categoryStats}}" wx:key="category">
        <view class="legend-color" style="background: {{item.color}};"></view>
        <view class="legend-text">{{item.name}} {{item.percentage}}%</view>
      </view>
    </view>
  </view>

  <!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
  <view class="transaction-list card" wx:if="{{transactions.length > 0}}">
    <view class="list-header">
      <view class="list-title">ğŸ“ äº¤æ˜“è®°å½•</view>
      <view class="list-count">å…± {{transactions.length}} ç¬”</view>
    </view>
    
    <view class="transaction-group" wx:for="{{groupedTransactions}}" wx:key="date">
      <view class="group-date">{{item.date}}</view>
      <view class="group-transactions">
        <view class="transaction-item" wx:for="{{item.transactions}}" wx:key="id" wx:for-item="transaction">
          <view class="transaction-info">
            <view class="transaction-icon {{transaction.category}}">{{transaction.icon}}</view>
            <view class="transaction-details">
              <view class="transaction-title">{{transaction.title || transaction.categoryName}}</view>
              <view class="transaction-meta">
                <text>{{transaction.time}}</text>
                <text wx:if="{{transaction.note}}"> Â· {{transaction.note}}</text>
              </view>
            </view>
          </view>
          <view class="transaction-amount {{transaction.type === 'income' ? 'amount-income' : 'amount-expense'}}">
            {{transaction.type === 'income' ? '+' : '-'}}Â¥{{transaction.amount}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{transactions.length === 0}}">
    <view class="empty-icon">ğŸ“Š</view>
    <view class="empty-title">æš‚æ— äº¤æ˜“è®°å½•</view>
    <view class="empty-subtitle">ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®å¼€å§‹è®°è´¦å§</view>
  </view>
</view>

<!-- æ·»åŠ è®°å½•æŒ‰é’® -->
<view class="add-btn" bindtap="openTransactionModal">
  <text>+</text>
</view>

<!-- æ·»åŠ äº¤æ˜“å¼¹çª— -->
<view class="modal" wx:if="{{showModal}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">{{modalType === 'income' ? 'âœ¨ æ·»åŠ æ”¶å…¥' : 'ğŸ›’ æ·»åŠ æ”¯å‡º'}}</view>
      <button class="close-btn" bindtap="closeModal">âœ•</button>
    </view>
    
    <!-- ç±»å‹åˆ‡æ¢ -->
    <view class="type-tabs">
      <button class="type-tab {{modalType === 'expense' ? 'active' : ''}}" 
              bindtap="switchModalType" data-type="expense">æ”¯å‡º</button>
      <button class="type-tab {{modalType === 'income' ? 'active' : ''}}" 
              bindtap="switchModalType" data-type="income">æ”¶å…¥</button>
    </view>
    
    <form bindsubmit="submitTransaction">
      <view class="form-group">
        <view class="form-label">ğŸ’° é‡‘é¢</view>
        <input class="form-input" type="digit" placeholder="è¯·è¾“å…¥é‡‘é¢" name="amount" 
               value="{{formData.amount}}" bindinput="onAmountInput" />
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ·ï¸ åˆ†ç±»</view>
        <view class="category-grid grid grid-4">
          <view class="category-item {{selectedCategory === item.value ? 'selected' : ''}}" 
                wx:for="{{categories}}" wx:key="value"
                bindtap="selectCategory" data-value="{{item.value}}">
            {{item.label}}
          </view>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-label">ğŸ“ å¤‡æ³¨</view>
        <input class="form-input" placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰" name="note" 
               value="{{formData.note}}" bindinput="onNoteInput" />
      </view>
      
      <button class="submit-btn btn-primary" form-type="submit">ç¡®è®¤æ·»åŠ </button>
    </form>
  </view>
</view>
